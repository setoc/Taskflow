# workflow, state, action, condition defined in this document
# object type on a line by itself
# attributes on following lines in the format of "attr=val"
# if an attribute has sub-values, they follow on the same line separated by semi-colons
#    "attr=val;parm=item;parm=item"
#
workflow
	name=dbupdate
	description=Scada Database Update Process
	workflow_state=initial
	
state
	name=initial
	description=Choose one of the following actions to begin
	state_action=database_snapshot;condition=user_is_authorized;condition=host_is_enabled;
	state_action=copy_archive_file

state
	name=database_snapshot_done
	description=Choose one of the following actions to continue
	state_action=copy_archive_file;condition=user_is_authorized

state
	name=archive_copy_done
	description=Choose one of the following actions to continue
	state_action=update_smp;condition=user_is_authorized;

action
	name=database_snapshot
	description=take a snapshot of the current online databases
	next_state=database_snapshot_done
	
action
	name=copy_archive_file
	description=copy the archive file from the modeling server to the hosts and load the SCADAMDL.EMS clone
	next_state=archive_copy_done

# the class referenced should sub-class App::Workflow::Condition::Base
# the class referenced by a condition is passed the condition name as a parameter to the "execute" function and it should return a true or false value
condition
	name=user_is_authorized
	description=Ensure user is authorized to perform an action
	class=App::Condition::User

condition
	name=host_is_enabled
	description=Ensure host is running and its AppSet is Enabled
	class=App::Condition::Host